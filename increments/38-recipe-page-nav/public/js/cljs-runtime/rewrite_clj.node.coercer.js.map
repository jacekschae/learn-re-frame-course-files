{"version":3,"sources":["rewrite_clj/node/coercer.cljs"],"sourcesContent":["(ns rewrite-clj.node.coercer\n  (:require [rewrite-clj.node.comment :refer [CommentNode]]\n            [rewrite-clj.node.forms :refer [FormsNode]]\n            [rewrite-clj.node.keyword :refer [KeywordNode]]\n            [rewrite-clj.node.quote :refer [QuoteNode]]\n            [rewrite-clj.node.stringz :refer [StringNode string-node]]\n            [rewrite-clj.node.uneval :refer [UnevalNode]]\n            [rewrite-clj.node.meta :refer [MetaNode meta-node]]\n            [rewrite-clj.node.fn :refer [FnNode]]\n            [rewrite-clj.node.protocols :refer [NodeCoerceable coerce]]\n            [rewrite-clj.node.reader-macro :refer [ReaderNode ReaderMacroNode DerefNode]]\n            [rewrite-clj.node.seq :refer [SeqNode vector-node list-node set-node map-node]]\n            [rewrite-clj.node.token :refer [TokenNode token-node]]\n            [rewrite-clj.node.whitespace :refer [WhitespaceNode NewlineNode whitespace-node space-separated]]))\n\n;; ## Helpers\n\n(defn node-with-meta\n  [n value]\n  (if (implements? IWithMeta value)\n    (let [mta (meta value)]\n      (if (empty? mta)\n        n\n        (meta-node (coerce mta) n)))\n    n))\n\n\n;; ## Tokens\n\n(extend-protocol NodeCoerceable\n  object\n  (coerce [v]\n    (node-with-meta\n      (token-node v)\n      v)))\n\n;; Number\n(extend-protocol NodeCoerceable\n  number\n  (coerce [n]\n    (node-with-meta\n     (token-node n)\n     n)))\n\n;; Number\n(extend-protocol NodeCoerceable\n  string\n  (coerce [n]\n    (node-with-meta\n     (string-node n)\n     n)))\n\n\n\n;; ## Seqs\n\n(defn seq-node\n  [f sq]\n  (node-with-meta\n    (->> (map coerce sq)\n         (space-separated)\n         (vec)\n         (f))\n    sq))\n\n(extend-protocol NodeCoerceable\n  PersistentVector\n  (coerce [sq]\n    (seq-node vector-node sq))\n  List\n  (coerce [sq]\n    (seq-node list-node sq))\n  PersistentHashSet\n  (coerce [sq]\n    (seq-node set-node sq)))\n\n\n\n\n;; ## Maps\n\n(let [comma (whitespace-node \", \")\n      space (whitespace-node \" \")]\n  (defn- map->children\n    [m]\n    (->> (mapcat\n           (fn [[k v]]\n             [(coerce k) space (coerce v) comma])\n           m)\n         (butlast)\n         (vec))))\n\n\n(extend-protocol NodeCoerceable\n  PersistentHashMap\n  (coerce [m]\n    (node-with-meta\n      (map-node (map->children m))\n      m)))\n\n\n\n\n;(seq-node vector-node [1])\n\n;; ## Vars\n\n;; (extend-protocol NodeCoerceable\n;;   Var\n;;   (coerce [v]\n;;     (-> (str v)\n;;         (subs 2)\n;;         (symbol)\n;;         (token-node)\n;;         (vector)\n;;         (var-node))))\n\n;; ## Existing Nodes\n\n(extend-protocol NodeCoerceable\n  CommentNode     (coerce [v] v)\n  FormsNode       (coerce [v] v)\n  FnNode          (coerce [v] v)\n  ;IntNode         (coerce [v] v)\n  KeywordNode     (coerce [v] v)\n  MetaNode        (coerce [v] v)\n  QuoteNode       (coerce [v] v)\n  ReaderNode      (coerce [v] v)\n  ReaderMacroNode (coerce [v] v)\n  DerefNode       (coerce [v] v)\n  StringNode      (coerce [v] v)\n  ;UnevalNode      (coerce [v] v)\n  NewlineNode     (coerce [v] v)\n  SeqNode         (coerce [v] v)\n  TokenNode       (coerce [v] v)\n  WhitespaceNode  (coerce [v] v))\n"],"mappings":"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","names":["rewrite-clj.node.coercer/node-with-meta","n","value","cljs.core/PROTOCOL_SENTINEL","mta","cljs.core/meta","cljs.core/empty?","rewrite_clj.node.meta.meta_node.cljs$core$IFn$_invoke$arity$2","rewrite-clj.node.protocols/coerce","goog.object/set","rewrite-clj.node.protocols/NodeCoerceable","G__30339","G__30340","G__30341","v","rewrite_clj.node.token.token_node.cljs$core$IFn$_invoke$arity$1","G__30342","G__30343","G__30344","G__30345","G__30346","G__30347","rewrite-clj.node.stringz/string-node","rewrite-clj.node.coercer/seq-node","f","sq","cljs.core.map.cljs$core$IFn$_invoke$arity$2","rewrite-clj.node.whitespace/space-separated","cljs.core/vec","G__30348","cljs.core/PersistentVector","rewrite-clj.node.seq/vector-node","cljs.core/List","rewrite-clj.node.seq/list-node","cljs.core/PersistentHashSet","rewrite-clj.node.seq/set-node","comma","rewrite-clj.node.whitespace/whitespace-node","space","rewrite-clj.node.coercer/map->children","m","cljs.core.mapcat.cljs$core$IFn$_invoke$arity$variadic","p__30349","vec__30350","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","k","cljs.core/butlast","cljs.core/PersistentHashMap","rewrite-clj.node.seq/map-node","rewrite-clj.node.comment/CommentNode","rewrite-clj.node.forms/FormsNode","rewrite-clj.node.fn/FnNode","rewrite-clj.node.keyword/KeywordNode","rewrite-clj.node.meta/MetaNode","rewrite-clj.node.quote/QuoteNode","rewrite-clj.node.reader-macro/ReaderNode","rewrite-clj.node.reader-macro/ReaderMacroNode","rewrite-clj.node.reader-macro/DerefNode","rewrite-clj.node.stringz/StringNode","rewrite-clj.node.whitespace/NewlineNode","rewrite-clj.node.seq/SeqNode","rewrite-clj.node.token/TokenNode","rewrite-clj.node.whitespace/WhitespaceNode"]}